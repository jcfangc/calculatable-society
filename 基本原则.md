# **基本原则**

- [惯性原则](#惯性原则)
- [概率原则](#概率原则)
- [自我评价](#自我评价)
- [基本定价](#基本定价)
- [等价互换](#等价互换)
- [高层拆解](#高层拆解)

## **惯性原则：**
- 文字表达：个人存在满足自身和扩大自身的趋势，是个人的内在属性。
- 数学表达：
    1. **个人层面满足自身**：
        - **定义**：在相互作用后，个体 $P$ 的利益 ($I$) 和不变的偏好 ($H$) 的点乘的模长变化，用以衡量个体的满足度。跟据不被满足或被满足，参与交易的对应偏好会相应增长。
        - **数学表达**：
            - 一个人是否通过交互被满足，其中 $I$ 和 $I'$ 分别为个体 $P$ 交互前后的 $I$ 向量：
             $$\Delta idv = ||I' \cdot H|| - ||I \cdot H||$$
            - 当个人不被满足时：
             $$ \Delta idv < 0 \Rightarrow  H' = H + |\Delta idv| $$
            - 此处 $H'$ 和 $H$ 都是指个人在交互中涉及的利益对应偏好。

    2. **社会层面个人增长**：
        - **定义**：考虑社会预期的变化，衡量个体在社会层面上的增长。
        - **数学表达**：
            - 令下式定义个体占有资源在相互作用前后在社会层面的变化，其中 $Exp(G) $表示相互作用前群体的期望:
            $$ \Delta sct = ||\frac{I(P)'}{Exp(G)}|| - ||\frac{I(P)}{Exp(G)}||$$
            - 在这里，$\frac{I(P)}{Exp(G)}$ 表示的是利益 $I(P)$ 的每个坐标除以 $Exp(G)$ 对应坐标的结果所构成的向量，即：
            $$
            \frac{I(P)}{Exp(G)} = \left[\frac{I(P)[x]}{Exp(G)[x]}, \frac{I(P)[y]}{Exp(G)[y]}, \frac{I(P)[z]}{Exp(G)[z]}, ... \right]
            $$
            - 当个人在社会层面未能得到增长时：
            $$ \Delta sct < 0 \Rightarrow  H' = H + |\Delta sct| $$
            - 此处 $H'$ 和 $H$ 是指社会期望最高的利益对应偏好。
    3. **交互效果衡量**：<p id="交互效果衡量"></p>
        - **定义**：通过变化值的向量表示来衡量交互效果。
        - **数学表达**：
            - 定义向量 $\vec{V}$，其中：
            $$
            \vec{V}[0] = \Delta idv\\
            \vec{V}[1] = \Delta sct
            $$
            - **定义标准满足向量** \( \vec{S}_{\text{标准}} \)：
            - 假设 \( \vec{S}_{\text{标准}} = (1, 1) \)，代表个体在一次交易中理想的满足状态。
            - **计算交互效果向量 \( \vec{V} \) 在 \( \vec{S}_{\text{标准}} \) 上的投影**，投影的计算可以使用点乘来实现：
                $$ \text{投影长度} = \frac{\vec{V} \cdot \vec{S}_{\text{标准}}}{||\vec{S}_{\text{标准}}||} $$
            由于 \( \vec{S}_{\text{标准}} \) 的模长为 \( \sqrt{2} \)，投影长度可以简化为：
                    $$ \text{投影长度} = \frac{\Delta idv + \Delta sct}{\sqrt{2}} $$

## **概率原则：**
- 文字表达：社会中发生的一切遵循基本的概率规律。

## **自我评价**
- 文字表达：在任何相互作用中，个体综合需求 $D$ 和偏好 $H$ 对某项即得利益 $I$ 进行评价，作用双方优先收入综合评价较高的资源，支出综合评价较低的资源。

- 数学表达：
    - 给定个体 $P$，其综合需求 $D(P)$ ，偏好 $H(P)$ 和市场预期 $Exp[x]$ 针对资源 $Ix$ 存在综合评价函数 $E(P)[x]$，该函数可以表示为：
    $$ E(P)[x] = D(P)[x] \cdot H(P)[x] \cdot Exp[x] $$

    - 当个体 $P$ 属于不同群体时，其期望选择各个群体中对于物资 $x$ 的期望中位数，即：
    $$ Exp[x] = median(Exp(G_0)[x], Exp(G_1)[x], Exp(G_2)[x], ...) $$

    - 相互作用双方都会根据综合评价函数 $E$ 对资源进行排序，评价越高的资源越靠前，即：
    $$  R = sort(I(P)) = [I_0, I_1, ..., I_i, I_{i+1}, ..., I_n] $$
    满足：
    $$ E[R[i]] \geq E[R[i+1]],\ i \in [0, n-1] $$
    其中 $R[0]$ 表示资源列表中的第一个资源 $I_0$，$R[1]$ 表示资源列表中的第二个资源 $I_1$，以此类推。这里显然是对 $P$ 进行说明，故 $E(P)[R[i]]$ 简写作 $E[R[i]]$。

    - 跟据惯性原则，个体 $P$ 在相互作用 $F$ 中，会大概率收入综合评价较高的资源，支出综合评价较低的资源，使用支出函数 $OUT$ 和收入函数 $IN$ 表示，输出结果是资源的集合：
    $$ Pb(R[i]\ \in\ IN(R)) \geq Pb(R[i+1]\ \in\ IN(R)) \\
    Pb(R[i]\ \in\ OUT(R)) \leq Pb(R[i+1]\ \in\ OUT(R)) $$

    - 设个体 $A$ 的 $IN$ 函数输出为集合 $IN_A$，个体 $B$ 的 $OUT$ 函数输出为集合 $OUT_B$。
    - 可交换的资源集合 $R_{ch} = IN_A \cap OUT_B$，即 $R_{ch}$ 是 $IN_A$ 和 $OUT_B$ 的交集。

        ```
        使用并查集数据结构，可以快速确定两个集合是否有交集。
        如果 $R_{ch}$ 非空，则表示存在可供交换的资源。
        ```

## **基本定价**
由相互作用任意一方首先开始喊价，具体动作如下：

1. **计算选择概率：**
   - 使用 $E(P_1)[x]$ 表示参与交互的个人 $P_1$ 对于任意物资 $x \in OUT_{P_2}$ 的选择概率，其中 $OUT_{P_2}$ 是指 $P_2$ 的支出集合。
   - 通俗一点说，就是个人 $P_1$ 对于个人 $P_2$ 即将的支出物资里面，感觉哪个更加有价值就更容易选哪个。
   - 以下是用`python`模拟“概率”的实现样例：
        ```python
        import numpy as np
        import random

        # 示例: 假设有一组资源及其对应的选择概率
        resources = ["Resource_1", "Resource_2", "Resource_3", "Resource_4"]
        probabilities = [3, 6, 8, 1]  # 这些概率应由 E(P)[x] 计算得出

        # 计算修改后的累积分布函数 (CDF)
        cdf = np.cumsum(probabilities)

        # 生成一个[0, cdf[-1]]区间的随机数
        random_number = random.uniform(0, cdf[-1])

        # 根据随机数选择资源
        selected_resource = resources[np.searchsorted(cdf, random_number)]

        print(selected_resource)
        ```
2. **计算交换数量（交换数量的自适应决定机制）：**
    1. **设置交换数量的范围**：
        - **下限（base）**：设为0，这意味着个体可以选择不与任何资源进行交换。
        - **上限（top）**：设为 \( I(G)[x] \)，即群体中该资源的总量，允许个体理论上获得所有可用的资源，尽管这在实践中可能不太可能发生。

    2. **个体叫价策略的自适应调整**：
        - 每个个体根据过往的交易经验和当前的需求、偏好来自适应调整其叫价策略。这可能包括调整希望获得的资源数量、愿意提供的资源数量以及这些数量的概率分布。个体可以通过观察交易成功与否、资源的获得量以及满足度的变化来学习和调整其策略。
        - **交易历史的优先级和维护：**
            1. **使用投影长度作为交易历史的优先级**：
                - 每次交易后，计算该交易的投影长度（参见“[惯性原则](#惯性原则)-数学表达-交互效果衡量”），以此作为衡量交易满足度的指标。投影长度越大，表示交易越能满足个体的需求。

            2. **维护交易历史记录**：
                - 个体维护一个包含最近十次交易的历史记录，每条记录包括交易的资源、交易数量、以及交易的投影长度。
                - 当新的交易发生时，比较新交易的投影长度与历史记录中的投影长度，保留投影长度最大的十次交易记录。
        - 具体来说，**历史记录可以包括以下内容**：
            1. **交易资源**：交易中涉及的资源种类。

            2. **交换数量**：
                - **提供的数量**：个体在交易中提供的资源数量。
                - **获得的数量**：个体从交易中获得的资源数量。

            3. **交易满足度**：交易后个体在个人层面和社会层面的满足度变化，可以使用前述的投影长度作为衡量指标。

            4. **交易时间**：交易发生的时间，有助于个体追踪交易历史的时间顺序。

            5. **交易伙伴**：交易的另一方个体，有助于个体评估与特定个体的交易效果。

            6. **交易前资源状态**：交易前个体持有的资源状况。

    3. **淘汰机制**：
        - 若个体无法通过交易获得其生存所需的最基本资源，该个体将被淘汰。这反映了自然选择的原则，即那些能够有效利用资源和交易机会的个体更有可能生存下来。

        - 数学描述：
            1. **定义关键资源集合**：
                - 假设有一个关键资源集合 \( R_{key} \)，其中包含了个体生存所需的所有最基本资源。

            2. **评估个体资源满足度**：
                - 对于每个个体 \( P \)，计算其对于每个关键资源 \( r \in R_{key} \) 的持有量 \( I(P)[r] \)。

            3. **淘汰判断条件**：
                - 对于个体 \( P \)，如果存在任何一个关键资源 \( r \in R_{key} \)，使得 \( I(P)[r] \) 小于该资源的生存阈值 \( \theta_r \)，则个体 \( P \) 将被淘汰。
                - 数学表达为：如果 \( \exists r \in R_{key}, I(P)[r] < \theta_r \)，则个体 \( P \) 被淘汰。

    4. **策略的多样性与演化**：
        - 允许策略的多样性存在，个体可以采用不同的叫价和交易策略。随着时间的推移，更有效的策略将会在群体中占据主导，但也应允许新策略的产生和测试，以促进系统的演化和适应性。


## **等价互换**
- **文字表达**：在资源交换的过程中，个体会使用自身的评价函数来评估对方提供的资源。个体将会比较自己即将支出的资源与对方提供资源的价值。如果对方的资源在个体的评价中等值或超过自己即将支出的资源，交换被视为等价或有利，从而有更高的可能性进行交换。

- **数学表达**：
    - 设定个体 $P_1$ 愿意交换的资源为 $x$，数量为 $\Delta I(P_1)[x]$，对方提供交换的资源为 $y$，数量为 $\Delta I(P_2)[y]$。个体 $P_1$ 对这两种资源的评价分别为 $E(P_1)[x]$ 和 $E(P_1)[y]$。
    
    - 等价互换的条件可以用以下不等式表示：

    $$ \Delta I(P_2)[y] \cdot E(P_1)[y] \geq \Delta I(P_1)[x] \cdot E(P_1)[x] $$
    
    - 这里，$\Delta I(P_2)[y] \cdot E(P_1)[y]$ 表示个体对对方提供的资源 $I_y$ 的总体评价值，而 $ \Delta I(P_1)[x] \cdot E(P_1)[x]$ 表示个体对自己即将支出的资源 $I_x$ 的总体评价值。
    
    - 如果该不等式成立，即对方提供的资源在个体评价中等值或超过自己的资源，个体更倾向于进行交换。

## **高层拆解**