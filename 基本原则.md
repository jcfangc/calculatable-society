# **基本原则**

- [惯性原则](#惯性原则)
    - [1. 文字表达](#1-文字表达)
    - [2. 数学表达](#2-数学表达)
        - [2.1. 个人层面满足自身](#21-个人层面满足自身)
            - [2.1.1. 定义](#211-定义)
            - [2.1.2. 数学表达](#212-数学表达)
        - [2.2. 社会层面个人增长](#22-社会层面个人增长)
            - [2.2.1. 定义](#221-定义)
            - [2.2.2. 数学表达](#222-数学表达)
        - [2.3. 交互效果衡量](#23-交互效果衡量)
            - [2.3.1. 定义](#231-定义)
            - [2.3.2. 数学表达](#232-数学表达)

- [概率原则](#概率原则)
    - [1. 文字表达](#1-文字表达-1)
- [自我评价](#自我评价)
    - [2. 文字表达](#2-文字表达-1)
    - [3. 数学表达](#3-数学表达)
        - [3.1. 综合评价函数](#31-综合评价函数)
            - [3.1.1. 定义](#311-定义)
            - [3.1.2. 市场预期](#312-市场预期)
        - [3.2. 资源排序](#32-资源排序)
            - [3.2.1. 定义](#321-定义)
        - [3.3. 支出和收入函数](#33-支出和收入函数)
            - [3.3.1. 概述](#331-概述)
            - [3.3.2. 可交换资源集合](#332-可交换资源集合)

- [基本定价](#基本定价)
    - [1. 计算选择概率](#1-计算选择概率)
        - [1.1. 概率模拟示例](#11-概率模拟示例)
    - [2. 计算交换数量](#2-计算交换数量)
        - [2.1. 交换数量范围](#21-交换数量范围)
            - [2.1.1. 下限（base）](#211-下限base)
            - [2.1.2. 上限（top）](#212-上限top)
        - [2.2. 个体叫价策略的自适应调整](#22-个体叫价策略的自适应调整)
            - [2.2.1. 交易历史的优先级和维护](#221-交易历史的优先级和维护)
            - [2.2.2.交易历史记录内容](#222交易历史记录内容)
            - [2.2.3. 总的交易信息](#223-总的交易信息)
            - [2.2.4. 自平衡的决策模型](#224-自平衡的决策模型)
        - [2.3. 淘汰机制](#23-淘汰机制)
            - [2.3.1. 定义关键资源集合](#231-定义关键资源集合)
            - [2.3.2. 淘汰判断条件](#232-淘汰判断条件)
        - [2.4. 策略的多样性与演化](#24-策略的多样性与演化)
        
- [等价互换](#等价互换)
    - [1. 文字表达](#1-文字表达-2)
    - [2. 数学表达](#2-数学表达-1)
        - [2.1. 评价函数和资源定义](#21-评价函数和资源定义)
        - [2.2. 等价互换条件](#22-等价互换条件)

---

# 惯性原则

## 1. 文字表达
个人存在满足自身和扩大自身的趋势，是个人的内在属性。

## 2. 数学表达

### 2.1. 个人层面满足自身

#### 2.1.1. 定义
在交易后，个体 $P$ 的利益 ($I$) 和不变的偏好 ($H$) 的点乘的模长变化，用以衡量个体的满足度。跟据不被满足或被满足，参与交易的对应偏好会相应增长。

#### 2.1.2. 数学表达
- 一个人是否通过交互被满足，其中 $I$ 和 $I'$ 分别为个体 $P$ 交互前后的 $I$ 向量：
$$\Delta idv = ||I' \cdot H|| - ||I \cdot H||$$
- 当个人不被满足时：
$$ \Delta idv < 0 \Rightarrow  H' = H + |\Delta idv| $$
此处 $H'$ 和 $H$ 都是指个人在交互中涉及的利益对应偏好。

### 2.2. 社会层面个人增长

#### 2.2.1. 定义
考虑社会预期的变化，衡量个体在社会层面上的增长。

#### 2.2.2. 数学表达
- 令下式定义个体占有资源在交易前后在社会层面的变化，其中 $Exp(G) $表示交易前群体的期望:
$$ \Delta sct = ||\frac{I(P)'}{Exp(G)}|| - ||\frac{I(P)}{Exp(G)}||$$
- 在这里，$\frac{I(P)}{Exp(G)}$ 表示的是利益 $I(P)$ 的每个坐标除以 $Exp(G)$ 对应坐标的结果所构成的向量，即：
$$
\frac{I(P)}{Exp(G)} = \left[\frac{I(P)[x]}{Exp(G)[x]}, \frac{I(P)[y]}{Exp(G)[y]}, \frac{I(P)[z]}{Exp(G)[z]}, ... \right]
$$
- 当个人在社会层面未能得到增长时：
$$ \Delta sct < 0 \Rightarrow  H' = H + |\Delta sct| $$ 此处 $H'$ 和 $H$ 是指社会期望最高的利益对应偏好。

### 2.3. 交互效果衡量

#### 2.3.1. 定义
通过变化值的向量表示来衡量交互效果。

#### 2.3.2. 数学表达
- 定义向量 $\vec{V}$，其中：
$$
\vec{V}[0] = \Delta idv\\
\vec{V}[1] = \Delta sct
$$
- **定义标准满足向量** $ \vec{S}_{\text{标准}} $：
假设 $ \vec{S}_{\text{标准}} = (1, 1) $，代表个体在一次交易中理想的满足状态。
- **计算交互效果向量 $ \vec{V} $ 在 $ \vec{S}_{\text{标准}} $ 上的投影**，投影的计算可以使用点乘来实现：
$$ \text{投影长度} = \frac{\vec{V} \cdot \vec{S}_{\text{标准}}}{||\vec{S}_{\text{标准}}||} $$
由于 $ \vec{S}_{\text{标准}} $ 的模长为 $ \sqrt{2} $，投影长度可以简化为：
$$ \text{投影长度} = \frac{\Delta idv + \Delta sct}{\sqrt{2}} $$

---

# 概率原则

## 1. 文字表达
社会中发生的一切遵循基本的概率规律。

---

# 自我评价

## 2. 文字表达
在任何交易中，个体综合需求 $D$ 和偏好 $H$ 对某项即得利益 $I$ 进行评价，作用双方优先收入综合评价较高的资源，支出综合评价较低的资源。

## 3. 数学表达

### 3.1. 综合评价函数

#### 3.1.1. 定义
给定个体 $P$，其综合需求 $D(P)$，偏好 $H(P)$ 和市场预期 $Exp[x]$ 针对资源 $Ix$ 存在综合评价函数 $E(P)[x]$，该函数可以表示为：
$$ E(P)[x] = D(P)[x] \cdot H(P)[x] \cdot Exp[x] $$

#### 3.1.2. 市场预期
当个体 $P$ 属于不同群体时，其期望选择各个群体中对于物资 $x$ 的期望中位数，即：
$$ Exp[x] = median(Exp(G_0)[x], Exp(G_1)[x], Exp(G_2)[x], ...) $$

### 3.2. 资源排序

#### 3.2.1. 定义
交易双方都会根据综合评价函数 $E$ 对资源进行排序，评价越高的资源越靠前，即：
$$ I_s = sort(I(P)) = [I_0, I_1, ..., I_i, I_{i+1}, ..., I_n] $$
满足：
$$ E[I_s[i]] \geq E[I_s[i+1]],\ i \in [0, n-1] $$

### 3.3. 支出和收入函数

#### 3.3.1. 概述
根据惯性原则，个体 $P$ 在交易 $Tr$ 中，会大概率收入综合评价较高的资源，支出综合评价较低的资源，使用支出函数 $OUT$ 和收入函数 $IN$ 表示，输出结果是资源的集合：
$$ Pb(I_s[i]\ \in\ IN(I_s)) \geq Pb(I_s[i+1]\ \in\ IN(I_s)) \\
Pb(I_s[i]\ \in\ OUT(I_s)) \leq Pb(I_s[i+1]\ \in\ OUT(I_s)) $$

#### 3.3.2. 可交换资源集合
设个体 $A$ 的 $IN$ 函数输出为集合 $IN_A$，个体 $B$ 的 $OUT$ 函数输出为集合 $OUT_B$。可交换的资源集合 $I_{ch} = IN_A \cap OUT_B$，即 $I_{ch}$ 是 $IN_A$ 和 $OUT_B$ 的交集。

```
使用并查集数据结构，可以快速确定两个集合是否有交集。
如果 $I_{ch}$ 非空，则表示存在可供交换的资源。
```

---

# 基本定价

## 1. 计算选择概率

个人 $P_1$ 对于个人 $P_2$ 即将支出的物资 $x \in OUT_{P_2}$ 的选择概率由 $E(P_1)[x]$ 表示，其中 $OUT_{P_2}$ 是指 $P_2$ 的支出集合。

### 1.1. 概率模拟示例

以下`python`代码模拟了如何根据资源的选择概率进行资源选择：

```python
import numpy as np
import random

# 示例: 假设有一组资源及其对应的选择概率
resources = ["Resource_1", "Resource_2", "Resource_3", "Resource_4"]
probabilities = [3, 6, 8, 1]  # 这些概率应由 E(P)[x] 计算得出

# 计算修改后的累积分布函数 (CDF)
cdf = np.cumsum(probabilities)

# 生成一个[0, cdf[-1]]区间的随机数
random_number = random.uniform(0, cdf[-1])

# 根据随机数选择资源
selected_resource = resources[np.searchsorted(cdf, random_number)]

print(selected_resource)
```

## 2. 计算交换数量

交换数量的自适应决定机制涉及设置交换数量范围、个体叫价策略的自适应调整、淘汰机制，以及策略的多样性与演化。

### 2.1. 交换数量范围

#### 2.1.1. 下限（base）

设为0，意味着个体可以选择不与任何资源进行交换。

#### 2.1.2. 上限（top）

设为 $ I(G)[x] $，即群体中该资源的总量。尽管这在实践中可能不太可能发生，但允许个体理论上获得所有可用的资源。

### 2.2. 个体叫价策略的自适应调整

每个个体根据过往的交易经验和当前的需求、偏好来自适应调整其叫价策略。这可能包括调整希望获得的资源数量、愿意提供的资源数量以及这些数量的概率分布。个体可以通过观察交易成功与否、资源的获得量以及满足度的变化来学习和调整其策略。

#### 2.2.1. 交易历史的优先级和维护

| 特征 | 描述 |
|------|------|
| **投影长度** | 每次交易后计算的投影长度作为衡量交易满足度的指标。投影长度越大，表示交易越能满足个体的需求。 |
| **交易历史记录** | 个体维护一个包含最近十次交易的历史记录，包括交易的资源、交易数量、以及交易的投影长度。当新的交易发生时，比较新交易的投影长度与历史记录中的投影长度，保留投影长度最大的十次交易记录。 |

#### 2.2.2.交易历史记录内容

| 细节 | 描述 |
|------|------|
| **交易资源** | 交易中涉及的资源种类。 |
| **交换数量** | 提供的数量：个体在交易中提供的资源数量。<br>获得的数量：个体从交易中获得的资源数量。 |
| **交易满足度** | 交易后个体在个人层面和社会层面的满足度变化，使用投影长度作为衡量指标。 |
| **交易时间** | 交易发生的时间，有助于个体追踪交易历史的时间顺序。 |
| **交易伙伴** | 交易的另一方个体，有助于个体评估与特定个体的交易效果。 |
| **交易前资源状态** | 交易前个体持有的资源状况。 |

#### 2.2.3. 总的交易信息

| 信息 | 描述 |
|------|------|
| **总的交易成功率** | 衡量所有交易中成功交易的比例。 |
| **关于某交易伙伴的交易成功率** | 衡量与特定交易伙伴进行交易的成功率。 |

#### 2.2.4. 自平衡的决策模型

参见“[基于随机森林的叫价模型](基于随机森林的叫价模型.md)”。

### 2.3. 淘汰机制

若个体无法通过交易获得其生存所需的最基本资源，将被淘汰。

#### 2.3.1. 定义关键资源集合

关键资源集合 $ R_{key} $ 包含了个体生存所需的所有最基本资源。

#### 2.3.2. 淘汰判断条件

如果个体 $P$ 对于任何一个关键资源 $r \in R_{key}$ 的持有量 $I(P)[r]$ 小于生存阈值 $\theta_r$，则个体 $P$ 被淘汰。数学表达为：

$$ \exists r \in R_{key}, I(P)[r] < \theta_r \Rightarrow \text{个体 } P \text{ 被淘汰} $$

在这里，$I(P)[r]$ 代表个体 $P$ 持有的资源 $r$ 的数量，$\theta_r$ 代表资源 $r$ 的生存阈值。如果个体 $P$ 的任何一个关键资源的持有量小于其对应的生存阈值，则认为个体 $P$ 无法继续生存，因此被淘汰。这一机制确保了只有能够有效管理和获取关键资源的个体能够在系统中存活下来。

### 2.4. 策略的多样性与演化

允许策略的多样性存在，并随时间推移进行演化和适应性调整。

---

# 等价互换

## 1. 文字表达

在资源交换的过程中，个体会使用自身的评价函数来评估对方提供的资源。个体将会比较自己即将支出的资源与对方提供资源的价值。如果对方的资源在个体的评价中等值或超过自己即将支出的资源，交换被视为等价或有利，从而有更高的可能性进行交换。

## 2. 数学表达

### 2.1. 评价函数和资源定义

设定个体 $P_1$ 愿意交换的资源为 $x$，数量为 $\Delta I(P_1)[x]$，对方提供交换的资源为 $y$，数量为 $\Delta I(P_2)[y]$。个体 $P_1$ 对这两种资源的评价分别为 $E(P_1)[x]$ 和 $E(P_1)[y]$。

### 2.2. 等价互换条件

等价互换的条件可以用以下不等式表示：

$$ \Delta I(P_2)[y] \cdot E(P_1)[y] \geq \Delta I(P_1)[x] \cdot E(P_1)[x] $$

这里，$\Delta I(P_2)[y] \cdot E(P_1)[y]$ 表示个体对对方提供的资源 $I_y$ 的总体评价值，而 $ \Delta I(P_1)[x] \cdot E(P_1)[x]$ 表示个体对自己即将支出的资源 $I_x$ 的总体评价值。

如果该不等式成立，即对方提供的资源在个体评价中等值或超过自己的资源，个体更倾向于进行交换。

